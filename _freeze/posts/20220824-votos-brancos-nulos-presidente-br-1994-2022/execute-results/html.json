{
  "hash": "8cd88a9333f6a4c3ef3a516f73ea3526",
  "result": {
    "markdown": "---\ntitle: 'Taxa de votos brancos e nulos para presidente no Brasil, de 1994 a 2022, usando Python'\nauthor: Artur Quirino\ndate: '2022-08-24'\ndate-modified: '2023-02-20'\nexecute:\n  warning: false\ncategories:\n  - elections\n  - python\n---\n\n## Importando as bibliotecas\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport basedosdados as bd\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n```\n:::\n\n\n## Download da tabela com dados das eleições brasileiras para presidente, de 1994 a 2022\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nvotos = bd.read_sql(\n    '''\n    SELECT sigla_uf, ano, turno, tipo_eleicao, cargo, \n    SUM(abstencoes) AS abstencoes, \n    SUM(votos_nominais) AS votos_nominais,\n    SUM(votos_brancos) AS votos_brancos,\n    SUM(votos_nulos) AS votos_nulos,\n    SUM(votos_coligacao) AS votos_coligacao\n    FROM `basedosdados.br_tse_eleicoes.detalhes_votacao_secao` \n    WHERE ano IN (1994, 1998, 2002, 2006, 2010, 2014, 2018, 2022) \n    AND cargo IN ('presidente')\n    AND sigla_uf NOT IN ('VT', 'ZZ')\n    GROUP BY sigla_uf, ano, turno, tipo_eleicao, cargo\n    ''',\n    billing_project_id = 'eieicoes'\n)\n```\n:::\n\n\n## Modelando os dados\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\n# Transforma a variável ano de numérica para categórica\nvotos['ano'] = votos.ano.astype(str)\nfactors = ['1994', '1998', '2002', '2006', '2010', '2014', '2018', '2022']\n\nvotos['ano'] = pd.Categorical(\n    votos['ano'],\n    ordered = True,\n    categories = factors\n    )\n\n# Transforma a variável 'sigla_uf' de str para categórica\nvotos['sigla_uf'] = pd.Categorical(\n    votos['sigla_uf'],\n    ordered = True,\n    categories = votos['sigla_uf'].unique()\n    )\n\n# Cria a variável 'votos_válidos' a partir da soma das variáveis 'votos_nominais' e 'votos_coligacao'.\nvars = ['votos_nominais', 'votos_coligacao']\nvotos['votos_validos'] = votos[vars].sum(axis = 1)\n\n# Cria a variável 'votos_total' a partir da soma das variáveis 'votos_validos', 'votos_brancos' e 'votos_nulos'.\nvars = ['votos_brancos', 'votos_nulos', 'votos_validos']\nvotos['votos_total'] = votos[vars].sum(axis = 1)\n\n# Cria as variáveis 'prop_votos_brancos', 'prop_votos_nulos' e 'prop_votos_validos'\nfor i, var, in enumerate(vars):\n    votos[f'prop_{var}'] = votos[var]/votos['votos_total'] *100\n    vars[i] = f'prop_{var}'\n\n# Seleciona as variáveis de interesse para a visualização de dados\nid_vars = ['sigla_uf', 'ano', 'cargo', 'turno']\nvars_ = id_vars + vars\n\n# Reconstrói a tabela a partir das variáveis de interesse\nvotos = votos[vars_].melt(\n    id_vars= id_vars, \n    value_name = 'tx'\n    )\n    \n# Recodifica a variável 'variable'\nreplace_values = ['Votos brancos', 'Votos nulos', 'Votos válidos']\nvotos['variable'] = votos['variable'].replace(vars, replace_values)\n```\n:::\n\n\n## Visualizando os dados\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\n# Configurações gerais dos gráficos\nsns.set_theme(\n    palette = 'deep',\n    style = 'ticks'\n)\n```\n:::\n\n\n### Votos brancos e nulos para presidente, por estado, 1994-2022\n\n#### Primeiro turno\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\n# Filtra os dados\ndata = votos[\n    (votos.turno == 1) &\n    (votos.variable != 'Votos válidos')\n    ]\n\nfactors = ['Votos brancos', 'Votos nulos']\n\ndata['variable'] = pd.Categorical(\n    data['variable'],\n    ordered = True,\n    categories = factors\n    )\n```\n:::\n\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\n# Gráfico\nplot = sns.relplot(\n    x = 'ano',\n    y = 'tx',\n    hue = 'variable',\n    col = 'sigla_uf',\n    col_wrap= 3,\n    kind ='line',\n    legend = True,\n    aspect= 1.2,\n    height= 3,\n    data = data,\n    markers = ['o','o'],\n    dashes = False,\n    style = 'variable'\n)\n\n# Redefine os títulos dos eixos\nplot.set(\n    xlabel = '',\n    ylabel = '% de votos'\n)\n\n# Define labels para os eixos de todos os plots   \nfor ax in plot.axes:\n    ax.tick_params(\n        labelbottom=True,\n        labelleft=True\n    )\n\n# Define as características da legenda\nsns.move_legend(\n    plot, \n    loc = \"upper center\",\n    title = 'Legenda',\n    ncol = 3,   \n    )\n\n# Ajustes \nplt.subplots_adjust(\n    hspace=0.4,\n     wspace=0.2,\n     top = .97\n    )\n\n# Estilo dos eixos\nsns.despine(\n    offset=10,\n     trim=True\n    )\n\n# Títulos dos plots\nplot.set_titles(\n    col_template = '{col_name}',\n    fontweight='bold'\n\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```\n<seaborn.axisgrid.FacetGrid at 0x7f6b3823fcd0>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](20220824-votos-brancos-nulos-presidente-br-1994-2022_files/figure-html/cell-7-output-2.png){width=1034 height=2580}\n:::\n:::\n\n\n#### Segundo turno\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\n# Filtra os dados\ndata = votos[\n    (votos.turno == 2) &\n    (votos.variable != 'Votos válidos')\n    ]\n\nfactors = ['Votos brancos', 'Votos nulos']\n\ndata['variable'] = pd.Categorical(\n    data['variable'],\n    ordered = True,\n    categories = factors\n    )\n```\n:::\n\n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\n# Gráfico\nplot = sns.relplot(\n    x = 'ano',\n    y = 'tx',\n    hue = 'variable',\n    col = 'sigla_uf',\n    col_wrap= 3,\n    kind ='line',\n    legend = True,\n    aspect= 1.2,\n    height= 3,\n    data = data,\n    markers = ['o','o'],\n    dashes = False,\n    style = 'variable'\n)\n\n# Redefine os títulos dos eixos\nplot.set(\n    xlabel = '',\n    ylabel = '% de votos'\n)\n\n# Define labels para os eixos de todos os plots   \nfor ax in plot.axes:\n    ax.tick_params(\n        labelbottom=True,\n        labelleft=True\n    )\n\n# Define as características da legenda\nsns.move_legend(\n    plot, \n    loc = \"upper center\",\n    title = 'Legenda',\n    ncol = 3,   \n    )\n\n# Ajustes \nplt.subplots_adjust(\n    hspace=0.4,\n     wspace=0.2,\n     top = .97\n    )\n\n# Estilo dos eixos\nsns.despine(\n    offset=10,\n     trim=True\n    )\n\n# Títulos dos plots\nplot.set_titles(\n    col_template = '{col_name}',\n    fontweight='bold'\n\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\n<seaborn.axisgrid.FacetGrid at 0x7f6add8d54c0>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](20220824-votos-brancos-nulos-presidente-br-1994-2022_files/figure-html/cell-9-output-2.png){width=1034 height=2580}\n:::\n:::\n\n\n",
    "supporting": [
      "20220824-votos-brancos-nulos-presidente-br-1994-2022_files"
    ],
    "filters": [],
    "includes": {}
  }
}